var myContainer = $("div.news");
$(myContainer).on('click', 'a', function () {
    var scrollTo = $(this);
    myContainer.animate({
        scrollTop: scrollTo.offset().top - myContainer.offset().top + myContainer.scrollTop()
    });
});
var json;
var interval;
window.onload=$.getJSON("https://aspelik1.firebaseio.com/.json",
	function(data){
		json=data;
		console.log(JSON.stringify(json, undefined, 2));
		$(document).ready(function(){
    	if(typeof(Storage)!="undefined" && localStorage.articleid)
    	{
    		document.getElementById("newspicture").src=json.article[localStorage.articleid%3].picture;
    		localStorage.articleid%=3;
    		changeText();
			if(localStorage.phase=="play"){
				document.getElementById("pausebutton").className="fa fa-pause fa-2x";
				interval=timer();
			}
			else if(localStorage.phase=="pause"){
				document.getElementById("pausebutton").className="fa fa-play fa-2x";
			}
    	}
    	else{
    		localStorage.articleid=1;
    		localStorage.phase="play";
    		action();
		}
    	}
	);
});


$(document).ready(function(){
	$("#previous").click(function(){
	         if(localStorage.articleid===0){
	         	localStorage.articleid=2;
	         }
	         else{
	         	localStorage.articleid--;
	         }
	         action();
	});

	$("#next").click(function(){
		if(localStorage.articleid==2){
			localStorage.articleid=0;
		}
		else{
		 	localStorage.articleid++;
		}
	     action();
	 	});

	$("#pause").click(function(){
		 if(localStorage.phase=="play"){
		 	localStorage.phase="pause";
		 	clearInterval(interval);

		 }
		 else if (localStorage.phase=="pause"){
			localStorage.phase="play";	
		 }
	});
});


function action(){
	changeImage();
	changeText();
}

function changeImage(){
		$("#newspicture").fadeOut("slow", function(){
	      $(this).attr("src",json.article[localStorage.articleid%3].picture).bind('onreadystatechange load', function(){
	         if (this.complete) $(this).fadeIn("slow");
	      });
		});
}

function changeText(){
	 document.getElementById("newstext").innerHTML = json.article[localStorage.articleid%3].text;
}

function timer()
{
	setInterval(
	function(){
		localStorage.articleid++;
		localStorage.articleid%=3;
		action();
	},2000);
}